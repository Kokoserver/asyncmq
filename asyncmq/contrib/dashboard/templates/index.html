{% extends "layout.html" %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">Dashboard Overview</h1>

  <div class="grid grid-cols-3 gap-4 mb-6">
    <div class="p-4 bg-white rounded shadow">
      <h2>Total Queues</h2>
      <div id="total-queues" class="text-3xl font-bold">
        {{ total_queues }}
      </div>
    </div>
    <div class="p-4 bg-white rounded shadow">
      <h2>Total Jobs</h2>
      <div id="total-jobs" class="text-3xl font-bold">
        {{ total_jobs }}
      </div>
    </div>
    <div class="p-4 bg-white rounded shadow">
      <h2>Total Workers</h2>
      <div id="total-workers" class="text-3xl font-bold">
        {{ total_workers }}
      </div>
    </div>
  </div>

  <script>

    // Subscribe to SSE endpoint
    const source = new EventSource('/events');

    source.addEventListener('overview', e => {
      try {
        const data = JSON.parse(e.data);
        document.getElementById('total-queues').textContent  = data.total_queues;
        document.getElementById('total-jobs').textContent    = data.total_jobs;
        document.getElementById('total-workers').textContent = data.total_workers;
      } catch (err) {
        console.error('Failed to parse SSE data:', err);
      }
    });

    source.onerror = err => {
      console.warn('SSE connection error:', err);
    };
  </script>
{% endblock %}
